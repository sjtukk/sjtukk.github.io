---
layout:     post
date:       2022-6-15
author:     "kk"
title: "lab3：page tables"
header-style: text
tags:
  - xv6
---



## A kernel page table per process

在xv6中，每个用户进程有一张用户空间页表，而在内核空间中，所有进程共用一张内核页表。从用户态到内核态的切换过程中，会把用户页表切成内核页表。这导致如果在内核态中，如果需要解引用一个用户空间的指针，因为指针里面记录的是虚拟地址，需要通过用户页表转换成物理地址，而无法直接在内核页表中直接进行地址映射。所以我们让一个进程拥有一张内核页表，里面记录着内核空间以及用户空间的地址转换。这样就可以在内核中直接进行用户空间的地址映射

因此需要做的事情有：

- 在内存控制块proc中增加一个字段，kernel_pagetable，让每一个进程都拥有一个内核页表
- 需要初始化该内核页表，初始化过程跟全局的内核页表完全一致
- 因为每个进程都有一张内核页表，所以每个进程的内核栈的虚拟地址是可以一样的

